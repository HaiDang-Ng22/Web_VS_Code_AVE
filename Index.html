<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Code Web</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="css/diary.css">
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">Đang khởi tạo ứng dụng...</p>
    </div>

    <!-- Database Error Modal -->
    <div id="db-error-modal" class="db-error-modal hidden">
        <div class="db-error-content">
            <div class="db-error-icon">
                <i class="fas fa-database"></i>
            </div>
            <h2>Lỗi kết nối Database</h2>
            <p>Không thể kết nối đến Firebase Database. Vui lòng kiểm tra:</p>
            
            <div class="offline-mode">
                <h4><i class="fas fa-info-circle"></i> Thông tin</h4>
                <p>Ứng dụng cần kết nối Firebase để hoạt động. Có thể có các nguyên nhân sau:</p>
                <ul>
                    <li>Không có kết nối Internet</li>
                    <li>Firebase Database Rules chưa được cấu hình đúng</li>
                    <li>API Key Firebase không hợp lệ</li>
                    <li>Database bị vô hiệu hóa trong Firebase Console</li>
                </ul>
            </div>
            
            <div class="db-error-actions">
                <button id="retry-connection-btn" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i> Thử kết nối lại
                </button>
                <button id="check-firebase-btn" class="btn btn-warning">
                    <i class="fas fa-external-link-alt"></i> Kiểm tra Firebase Console
                </button>
            </div>
            
            <div class="db-error-footer">
                <p>Nếu vẫn gặp lỗi, vui lòng liên hệ quản trị viên.</p>
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div id="auth-container" class="auth-container hidden">
        <div class="couple-container">
            <!-- Phần hình ảnh bên trái -->
            <div class="couple-illustration">
                <h1>Hai Dua Minh <span class="heart">❤️</span></h1>
                <p>Cảm ơn em vì đã chọn yêu anh</p>
                
                <div class="couple-image">
                    <i class="fas fa-heart"></i>
                </div>
                
                <div class="love-quote">
                    "Đây là trang web mà anh làm ra để thay lời mình muốn nói với em"
                </div>
            </div>
            
            <!-- Phần form đăng nhập bên phải -->
            <div class="login-form-side">
                <div class="login-header">
                    <h2>Chào em yêu <span class="heart">❤️</span></h2>
                    <p>Web này anh làm ra chỉ để dành riêng cho anh và em</p>
                </div>
                
                <div id="login-form" class="login-form">
                    <div id="login-error" class="error-message hidden">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Đã có lỗi xảy ra. Vui lòng thử lại!</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-email">Tài Khoản</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="login-email" placeholder="tinhyeucuaminh@gmail.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Mật khẩu bí mật</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="login-password" placeholder="••••••••">
                        </div>
                    </div>
                    
                    <button class="btn btn-love" id="login-btn">
                        <i class="fas fa-heart"></i> Đăng nhập 
                    </button>
                    
                    <div class="social-links">
                        <a href="https://www.instagram.com/he_den.ng2407/" target="_blank" class="instagram-link">
                            <i class="fab fa-instagram"></i>Instagram 
                        </a>
                    </div>
                    
                    <div class="login-footer">
                        <p><i class="fas fa-heart"></i> Mãi yêu em, người anh yêu nhất trên đời</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="main-container hidden">
        <div class="header">
            <div class="logo">
                <i class="fas fa-code"></i>
                <span>Code Love</span>
            </div>
            <div class="user-info">

                <div class="user-name" id="admin-name">Admin User</div>
                <div class="user-avatar" id="admin-avatar">A</div>
                <button class="btn btn-danger btn-sm" id="admin-logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </div>
        </div>
        
        <div class="admin-dashboard">
            <div class="admin-sidebar">
                <div class="admin-sidebar-header">
                    <h3><i class="fas fa-code-branch"></i> Quản lý Code</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="add-code-btn">
                            <i class="fas fa-plus"></i> Thêm code mới
                        </button>
                        <button class="btn btn-love" id="admin-toolbar-diary-btn" style="background: linear-gradient(135deg, #ff9ec0 0%, #d9a6ff 100%);">
                            <i class="fas fa-book-heart"></i> Mở nhật ký
                        </button>
                    </div>
                </div>
                
                <div class="code-list" id="code-list">
                    <!-- Code items will be loaded here -->
                </div>
                
                <div class="admin-sidebar-footer">
                    <div class="form-group">
                        <label>
                            <i class="fas fa-eye"></i> Code đang hiển thị cho em yêu:
                        </label>
                        <div id="selected-code-display">
                            <div>Chưa có code nào được chọn</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="admin-content">
                <div class="admin-toolbar">
                    <h2><i class="fas fa-edit"></i> <span id="editor-title">Chỉnh sửa Code</span></h2>
                    <div class="admin-toolbar-actions">
                        <!-- Thêm nút Nhật ký vào toolbar admin -->

                        <button class="btn btn-success" id="save-code-btn">
                            <i class="fas fa-save"></i> Lưu thay đổi
                        </button>
                        <button class="btn btn-warning" id="set-as-user-code-btn">
                            <i class="fas fa-eye"></i> Chọn hiển thị cho Cục dàng
                        </button>
                        <button class="btn btn-danger" id="delete-code-btn">
                            <i class="fas fa-trash"></i> Xóa code này
                        </button>
                    </div>
                </div>
                
                <div class="editor-container">
                    <div class="code-editor-section">
                        <div class="editor-header">
                            <h3><i class="fas fa-code"></i> Editor</h3>
                            <div class="editor-actions">
                                <select id="language-selector">
                                    <option value="html">HTML</option>
                                    <option value="css">CSS</option>
                                    <option value="javascript">JavaScript</option>
                                </select>
                            </div>
                        </div>
                        <textarea id="code-editor" placeholder="Nhập code của bạn ở đây..."></textarea>
                    </div>
                    
                    <div class="resize-handle" id="resize-handle"></div>
                    
                    <div class="preview-section">
                        <div class="preview-header">
                            <h3><i class="fas fa-eye"></i> Kết quả Preview</h3>
                            <button class="btn btn-primary btn-sm" id="refresh-preview-btn">
                                <i class="fas fa-sync-alt"></i> Làm mới
                            </button>
                        </div>
                        <div class="preview-content">
                            <iframe id="preview-frame"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User View -->
    <div id="user-view" class="user-view hidden">
        <div class="user-view-content">
            <div class="user-mini-controls">
                <div class="user-info-mini">
                    <div class="user-avatar-mini" id="user-avatar-mini">U</div>
                    <span id="user-name-mini">User</span>
                </div>
                <!-- Thêm nút Nhật ký vào user mini controls -->
                <button class="btn btn-sm" id="user-diary-btn" style="background: linear-gradient(135deg, #ff9ec0 0%, #d9a6ff 100%); color: white; border-radius: 20px; padding: 8px 15px; margin: 0 10px;">
                    <i class="fas fa-book-heart"></i> Nhật ký
                </button>
                <button class="btn btn-danger btn-sm" id="user-logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            
            <!-- Thêm nút Nhật ký nổi bật cho user -->
            <button class="fullscreen-exit-btn" id="user-floating-diary-btn" title="Mở nhật ký tình yêu" style="left: 20px; right: auto; background: linear-gradient(135deg, #ff9ec0 0%, #d9a6ff 100%);">
                <i class="fas fa-book-heart"></i>
            </button>
            
            <div class="code-info-overlay">
                <h4 id="current-code-title">Đang tải code...</h4>
                <p id="code-description">Code này anh thay lời muốn nói của anh á em yêu</p>
                <p id="code-update-time"></p>
            </div>
            
            <!-- Exit fullscreen button -->
            <button class="fullscreen-exit-btn" id="exit-fullscreen-btn" title="Thoát chế độ xem">
                <i class="fas fa-compress"></i>
            </button>
            
            <!-- Fullscreen iframe -->
            <div class="user-preview-container">
                <div class="user-preview-frame-container">
                    <iframe id="user-preview-frame"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Code Modal -->
    <div id="code-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title"><i class="fas fa-plus-circle"></i> Thêm code mới</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="code-title"><i class="fas fa-heading"></i> Tiêu đề</label>
                    <input type="text" id="code-title" placeholder="Nhập tiêu đề code">
                </div>
                <div class="form-group">
                    <label for="modal-language-selector"><i class="fas fa-language"></i> Ngôn ngữ</label>
                    <select id="modal-language-selector">
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="javascript">JavaScript</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="code-description-input"><i class="fas fa-align-left"></i> Mô tả (tùy chọn)</label>
                    <input type="text" id="code-description-input" placeholder="Mô tả ngắn về code">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-modal-btn">
                    <i class="fas fa-times"></i> Hủy
                </button>
                <button class="btn btn-primary" id="save-modal-btn">
                    <i class="fas fa-save"></i> Lưu
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/firebase-api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/user.js"></script>
    <script src="js/app.js"></script>
    <script src="js/diary.js"></script>
</body>
</html>
